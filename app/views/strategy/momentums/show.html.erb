<div id="strategy">
  <p>
    <h2><%= @strategy.name %></h2>
    <em>A <%= @strategy.classification.capitalize %> Strategy</em>
  </p>

  <p>
    <%= link_to 'Back', strategies_path %>
    <%= link_to 'Edit', edit_strategy_momentum_path(@strategy) %>
    <%= link_to 'Delete', strategy_momentum_path(@strategy), method: :delete %>
  </p>

  <div class="legend">
    <p>
      <span class="indicator buy"></span>
      Buy when the <strong><%= Formula.display(@buy.name) %>(<span id="buy"><%= @buy.value.to_i %></span>)</strong> is less than the current value of Bitcoin.
    </p>
    <p>
      <span class="indicator sell"></span>
      Sell when the <strong><%= Formula.display(@sell.name) %>(<span id="sell"><%= @sell.value.to_i %></span>)</strong> is greater than the current value of Bitcoin.
    </p>
    <p>
      <span class="indicator both"></span>
      Both buy and sell conditions are met
    </p>
    <p>
      <span class="indicator none"></span>
      Neither sell or buy.
    </p>
  </div>
</div>

<div id="chart"></div>

<script>
$(document).on('ready page:load', function() {
  var values = {
    'buy' : $('#sell').text(),
    'sell' : $('#buy').text(),
  };

  function getChart() {
    $.ajax({
      url: 'http://localhost:3000/ticks',
      method: 'get',
      dataType: 'json',
      data: {
        'count': 120,
        'type': 'momentum',
        'buy_calc': '<%= @sell.name %>',   'buy_range': values.buy,
        'sell_calc': '<%= @buy.name %>',  'sell_range': values.sell,
      }
    }).done(function(ticksJSON) {
      var ticksArr = getTicksArray( ticksJSON );
      google.setOnLoadCallback( drawGraph(ticksArr) );
    });
  };

  getChart();
});
</script>